---
import UnifiedLayout from '../../layouts/UnifiedLayout.astro'
import Hero from '../../components/Home/Hero.astro'
import About from '../../components/Home/About.astro'
import Services from '../../components/Home/Services.astro'
import Expertise from '../../components/Home/Expertise.astro'
import CaseStudies from '../../components/Home/CaseStudies.astro'
import LatestInsights from '../../components/Home/LatestInsights.astro'
// Sezione Series: articoli con categoria "series"
import AIDemos from '../../components/Home/AIDemos.astro'
import Testimonials from '../../components/Home/Testimonials.astro'
import Contact from '../../components/Home/Contact.astro'
import { getCollection, getEntry } from 'astro:content'
import it from '../../i18n/it.json'

// Dati per la pillar page
const latestInsights = await getCollection('insights', ({ id }) => 
  !id.startsWith('en-') && !id.startsWith('sl-')
)
const recentInsights = latestInsights
  .filter(post => post.data.status === 'publish')
  .sort((a, b) => new Date(b.data.date || 0).getTime() - new Date(a.data.date || 0).getTime())
  .slice(0, 3)

// Series: filtra gli insights che contengono la categoria "series"
const seriesInsights = latestInsights
  .filter(post => post.data.status === 'publish')
  .filter(post => Array.isArray(post.data.categories) && post.data.categories.some((c) => `${c}`.toLowerCase() === 'series'))
  .sort((a, b) => new Date(b.data.date || 0).getTime() - new Date(a.data.date || 0).getTime())
  .slice(0, 3)

const featuredCaseStudies = await getCollection('caseStudies', ({ id }) => 
  !id.startsWith('en-') && !id.startsWith('sl-')
)
const recentCaseStudies = featuredCaseStudies
  .sort((a, b) => new Date(b.data.date || 0).getTime() - new Date(a.data.date || 0).getTime())
  .slice(0, 3)

// MDX home (IT)
const home = await getEntry('pages', 'home')
const H = (home?.data ?? it.pages.home)
---

<UnifiedLayout enableTransitions={true} title={H.title ?? it.pages.home.title} description={H.description ?? it.pages.home.description} useLocalizedMeta={true} pageKey="home">
  <Hero eyebrow={H.hero?.eyebrow ?? it.pages.home.hero.eyebrow} title={H.hero?.title ?? it.pages.home.hero.title} subtitle={H.hero?.subtitle ?? it.pages.home.hero.subtitle} primary={{ href: '/it/servizi/', label: H.hero?.primaryLabel ?? it.pages.home.hero.primaryLabel }} secondary={{ href: '/it/case-studies/', label: H.hero?.secondaryLabel ?? it.pages.home.hero.secondaryLabel }} afterButtons={H.hero?.afterButtons} />
  <About 
    title={H.about?.title ?? it.pages.home.about.title}
    lead={H.about?.lead ?? it.pages.home.about.lead}
    paragraph={H.about?.paragraph ?? it.pages.home.about.paragraph}
    tags={H.about?.tags ?? it.pages.home.about.tags}
    linkHref={H.about?.linkHref ?? it.pages.home.about.linkHref}
    linkText={H.about?.linkText ?? it.pages.home.about.linkText}
    photoLabel={H.about?.photoLabel ?? it.pages.home.about.photoLabel}
    photoName={H.about?.photoName ?? it.pages.home.about.photoName}
    yearsBadgeValue={H.about?.yearsBadgeValue ?? it.pages.home.about.yearsBadgeValue}
    yearsBadgeSubtitle={H.about?.yearsBadgeSubtitle ?? it.pages.home.about.yearsBadgeSubtitle}
    imageSrc={H.about?.imageSrc ?? it.pages.home.about.imageSrc}
    imageAlt={H.about?.imageAlt ?? it.pages.home.about.imageAlt}
    imageAspectClass={H.about?.imageAspectClass ?? it.pages.home.about.imageAspectClass}
  />
  <Services 
    title={H.services?.title ?? it.pages.home.services.title}
    subtitle={H.services?.subtitle ?? it.pages.home.services.subtitle}
    servicesLinkBase={H.services?.servicesLinkBase ?? it.pages.home.services.servicesLinkBase}
    bottomCtaText={H.services?.bottomCtaText ?? it.pages.home.services.bottomCtaText}
    bottomCtaHref={H.services?.bottomCtaHref ?? it.pages.home.services.bottomCtaHref}
    services={H.services?.items ?? it.pages.home.services.items}
    afterCta={H.services?.afterCta}
  />
  <Expertise 
    title={H.expertise?.title ?? it.pages.home.expertise.title}
    subtitle={H.expertise?.subtitle ?? it.pages.home.expertise.subtitle}
    ctaText={H.expertise?.ctaText ?? it.pages.home.expertise.ctaText}
    ctaHref={H.expertise?.ctaHref ?? it.pages.home.expertise.ctaHref}
    areas={H.expertise?.areas ?? it.pages.home.expertise.areas}
  />
  <LatestInsights 
    items={seriesInsights} 
    baseUrl="/it/insights" 
    title="Serie in evidenza"
    subtitle="Percorsi tematici per approfondire un argomento, step-by-step"
    allArticlesLabel="Tutte le serie"
    locale={it.pages.home.latestInsights.locale}
  />
  <CaseStudies 
    items={recentCaseStudies} 
    baseUrl="/it/case-studies" 
    title={H.caseStudies?.title ?? it.pages.home.caseStudies.title} 
    subtitle={H.caseStudies?.subtitle ?? it.pages.home.caseStudies.subtitle}
    allProjectsLabel={H.caseStudies?.allProjectsLabel ?? it.pages.home.caseStudies.allProjectsLabel}
  />
  <LatestInsights 
    items={recentInsights} 
    baseUrl="/it/insights" 
    title={H.latestInsights?.title ?? it.pages.home.latestInsights.title} 
    subtitle={H.latestInsights?.subtitle ?? it.pages.home.latestInsights.subtitle}
    allArticlesLabel={H.latestInsights?.allArticlesLabel ?? it.pages.home.latestInsights.allArticlesLabel}
    locale={H.latestInsights?.locale ?? it.pages.home.latestInsights.locale}
  />
  <AIDemos 
    title="Dimostrazioni AI"
    subtitle="Scopri le potenzialità dell'intelligenza artificiale applicata allo sviluppo"
    ctaText="Scopri di più sui miei servizi AI"
    ctaHref="/it/servizi/"
    playgroundTitle="AI Code Playground"
    playgroundDescription="Analizza e ottimizza il tuo codice con l'intelligenza artificiale. Incolla uno snippet e scopri come migliorarlo."
    playgroundHref="/it/ai-playground/"
  />
  <Testimonials 
    title={it.pages.home.testimonials.title}
    items={it.pages.home.testimonials.items}
  />
  <Contact lang="it" />
</UnifiedLayout>
