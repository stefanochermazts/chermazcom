---
import PostLayout from '../../../layouts/PostLayout.astro'
import { getCollection, getEntry, render } from 'astro:content'

export const prerender = true;

export async function getStaticPaths() {
  const collection = await getCollection('insights', ({ id }) => 
    id.startsWith('sl-')
  )
  return collection
    .filter((e) => (e.data?.status ?? 'publish') === 'publish')
    .map((e) => {
      const full = e.slug ?? e.id.replace(/\.mdx?$/, '')
      const local = full.replace(/^sl-/, '')
      return { params: { slug: local } }
    })
}

const { slug } = Astro.params
const entry = await getEntry('insights', `sl-${slug}`)
if (!entry) throw new Error('Not found')
const { Content } = await render(entry)
---
<PostLayout frontmatter={entry.data} slug={slug}>
  <Content />
</PostLayout>


