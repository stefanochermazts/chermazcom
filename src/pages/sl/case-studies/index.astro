---
import UnifiedLayout from '../../../layouts/UnifiedLayout.astro'
import CaseStudyCard from '../../../components/CaseStudyCard.astro'
import { getCollection } from 'astro:content'
// Optimized collection loading
const studies = (await getCollection('caseStudies', ({ id }) => id.startsWith('sl-')))
  .filter(s => s.data.status !== 'draft') // Exclude drafts
  .sort((a, b) => new Date(b.data.date || 0).getTime() - new Date(a.data.date || 0).getTime())
---

<UnifiedLayout useLocalizedMeta={true} pageKey="caseStudies">
  <section class="py-16 sm:py-20">
    <div class="mx-auto max-w-[1366px] px-4 sm:px-6 lg:px-8">
      <h1 class="text-4xl font-bold mb-8">Študije primerov</h1>
      <div id="cs-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {studies.map((s, i) => (
          <div data-cs-card class:list={{'': true, 'hidden': i >= 6}}>
            <CaseStudyCard caseStudy={{...s, slug: (s.slug ?? s.id.replace(/\.mdx?$/, '')).replace(/^sl-/,'')}} baseUrl="/sl/case-studies" />
          </div>
        ))}
      </div>
      <div id="cs-sentinel" aria-hidden="true" class="h-8"></div>
      <div class="mt-6 flex justify-center">
        <button id="cs-load-more" class="button hidden">Naloži več</button>
      </div>
    </div>
  </section>
</UnifiedLayout>


