---
const { class: className = '' } = Astro.props
---
<div class:list={[className, 'faq-section']}>
  <slot />
</div>

<script>
  if (typeof document !== 'undefined') {
    const enhance = (container) => {
      if (!container || container.__faqEnhanced) return
      container.__faqEnhanced = true

      const children = Array.from(container.childNodes)
      for (let i = 0; i < children.length; i++) {
        const node = children[i]
        if (node.nodeType === 1 && node.tagName === 'H3') {
          const h3 = node
          const details = document.createElement('details')
          details.className = 'faq-item'
          const summary = document.createElement('summary')
          summary.className = 'faq-summary'
          summary.textContent = h3.textContent || ''
          details.appendChild(summary)

          let sib = h3.nextSibling
          while (sib && !(sib.nodeType === 1 && (sib.tagName === 'H2' || sib.tagName === 'H3'))) {
            const next = sib.nextSibling
            details.appendChild(sib)
            sib = next
          }
          h3.replaceWith(details)
        }
      }
    }

    try {
      // Primo tentativo: elemento immediatamente precedente allo script
      const prev = document.currentScript?.previousElementSibling
      if (prev && prev.classList?.contains('faq-section')) {
        enhance(prev)
      } else {
        // Fallback: cerca l'ultimo .faq-section più vicino nello stesso livello
        const parent = document.currentScript?.parentElement
        const candidate = parent?.querySelector(':scope > .faq-section:last-of-type') || document.querySelector('.faq-section:last-of-type')
        if (candidate) enhance(candidate)
      }

      // Ulteriore sicurezza: se il DOM non è ancora pronto
      document.addEventListener('astro:page-load', () => {
        document.querySelectorAll('.faq-section').forEach(enhance)
      })
      document.addEventListener('DOMContentLoaded', () => {
        document.querySelectorAll('.faq-section').forEach(enhance)
      })
    } catch {}
  }
</script>

<style>
  .faq-section {
    display: grid;
    gap: 0.75rem;
  }
  details.faq-item {
    border: 1px solid var(--color-neutral-300);
    border-radius: 0.75rem;
    padding: 0.75rem 1rem;
    
    :global(.dark) &,
    :global(.darkmode) & {
      border-color: var(--color-neutral-700);
    }
  }
  details.faq-item + details.faq-item { margin-top: 0.5rem; }
  summary.faq-summary {
    cursor: pointer;
    font-weight: 600;
    outline-offset: 2px;
  }
  summary.faq-summary:focus-visible {
    outline: 2px solid var(--brand-500, #1f63ff);
  }
</style>


