# Chermaz.com - Cursor Rules

## Architettura Internazionalizzazione (i18n)

### Overview
Il sito usa un sistema i18n custom per Astro con 3 lingue: IT (default), EN, SL.
**IMPORTANTE**: Non usare mai sottocartelle per i contenuti - Astro non le rileva correttamente.

### Struttura Contenuti

#### ğŸ—‚ï¸ Content Collections

```
src/content/
â”œâ”€â”€ insights/           # Articoli blog
â”‚   â”œâ”€â”€ article-slug.mdx          # ğŸ‡®ğŸ‡¹ Italiano (root, default)
â”‚   â”œâ”€â”€ en-article-slug.mdx       # ğŸ‡¬ğŸ‡§ Inglese (prefisso en-)
â”‚   â””â”€â”€ sl-article-slug.mdx       # ğŸ‡¸ğŸ‡® Sloveno (prefisso sl-)
â”œâ”€â”€ case-studies/       # Case study
â”‚   â”œâ”€â”€ case-slug.mdx             # ğŸ‡®ğŸ‡¹ Italiano (root, default) 
â”‚   â”œâ”€â”€ en-case-slug.mdx          # ğŸ‡¬ğŸ‡§ Inglese (prefisso en-)
â”‚   â””â”€â”€ sl-case-slug.mdx          # ğŸ‡¸ğŸ‡® Sloveno (prefisso sl-)
â””â”€â”€ pages/              # Pagine statiche
    â”œâ”€â”€ servizi.mdx               # ğŸ‡®ğŸ‡¹ Italiano (root, default)
    â”œâ”€â”€ chi-sono.mdx              # ğŸ‡®ğŸ‡¹ Italiano (root, default)
    â”œâ”€â”€ privacy.mdx               # ğŸ‡®ğŸ‡¹ Italiano (root, default)
    â”œâ”€â”€ en-services.mdx           # ğŸ‡¬ğŸ‡§ Inglese (prefisso en-)
    â”œâ”€â”€ en-about.mdx              # ğŸ‡¬ğŸ‡§ Inglese (prefisso en-)
    â”œâ”€â”€ en-privacy.mdx            # ğŸ‡¬ğŸ‡§ Inglese (prefisso en-)
    â”œâ”€â”€ sl-services.mdx           # ğŸ‡¸ğŸ‡® Sloveno (prefisso sl-)
    â”œâ”€â”€ sl-about.mdx              # ğŸ‡¸ğŸ‡® Sloveno (prefisso sl-)
    â””â”€â”€ sl-privacy.mdx            # ğŸ‡¸ğŸ‡® Sloveno (prefisso sl-)
```

### âš ï¸ REGOLE CRITICHE

#### 1. **MAI usare sottocartelle per lingua**
```
âŒ SBAGLIATO:
src/content/insights/en/article.mdx
src/content/insights/it/article.mdx

âœ… CORRETTO:
src/content/insights/article.mdx       # IT default
src/content/insights/en-article.mdx    # EN
```

#### 2. **Filtri getCollection per Lingua**
```typescript
// ğŸ‡®ğŸ‡¹ Contenuti italiani (default, root)
const italianPosts = await getCollection('insights', ({ id }) => 
  !id.startsWith('en-') && !id.startsWith('sl-')
)

// ğŸ‡¬ğŸ‡§ Contenuti inglesi 
const englishPosts = await getCollection('insights', ({ id }) => 
  id.startsWith('en-')
)

// ğŸ‡¸ğŸ‡® Contenuti sloveni
const slovenePosts = await getCollection('insights', ({ id }) => 
  id.startsWith('sl-')
)
```

#### 3. **Frontmatter obbligatorio**
```yaml
---
title: "Titolo articolo"
slug: article-slug           # IT: no prefisso
# slug: en-article-slug     # EN: prefisso en-
# slug: sl-article-slug     # SL: prefisso sl-
lang: it                    # it | en | sl
status: publish             # publish | draft
excerpt: "Descrizione breve"
date: 2024-01-01
categories: ["Cat1", "Cat2"]
tags: ["tag1", "tag2"]
---
```

#### 4. **URL Structure**
```
ğŸ‡®ğŸ‡¹ IT: /it/insights/article-slug/
ğŸ‡¬ğŸ‡§ EN: /en/insights/article-slug/        # NOTA: slug senza prefisso en-
ğŸ‡¸ğŸ‡® SL: /sl/insights/article-slug/        # NOTA: slug senza prefisso sl-
```

#### 5. **Component ArticleCard**
```astro
<!-- Sempre passare baseUrl per links corretti -->
<ArticleCard post={post} baseUrl="/it/insights" />    <!-- IT -->
<ArticleCard post={post} baseUrl="/en/insights" />    <!-- EN -->
<ArticleCard post={post} baseUrl="/sl/insights" />    <!-- SL -->
```

### ğŸ”§ Routine di Creazione Contenuti

#### Per creare contenuto EN da IT:
```bash
# 1. Copia file IT â†’ EN con prefisso
cp src/content/insights/article.mdx src/content/insights/en-article.mdx

# 2. Update frontmatter
# slug: article-slug â†’ slug: en-article-slug  
# lang: it â†’ lang: en

# 3. Traduci contenuto (mantenere stessa struttura)
```

#### Per aggiornare route dopo nuovi contenuti:
1. Verificare filtri `getCollection` in tutte le route correlate
2. Testare URL generation in `ArticleCard`/`CaseStudyCard`
3. Verificare `getStaticPaths` genera slug corretti (senza prefisso linguistico)

### ğŸ§ª Testing Checklist

#### Ogni lingua deve avere:
- [ ] `/[lang]/insights/` â†’ Lista con categorie + articoli
- [ ] `/[lang]/insights/categoria/[cat]/` â†’ Filtro categoria
- [ ] `/[lang]/insights/[slug]/` â†’ Articolo singolo  
- [ ] `/[lang]/case-studies/` â†’ Lista case studies
- [ ] `/[lang]/case-studies/[slug]/` â†’ Case study singolo
- [ ] `/[lang]/services` `/[lang]/about` `/[lang]/privacy` â†’ Pagine statiche

#### Link devono puntare alla lingua corretta:
- [ ] Links da `/it/insights/` â†’ `/it/insights/[slug]/`
- [ ] Links da `/en/insights/` â†’ `/en/insights/[slug]/` 
- [ ] Links da `/sl/insights/` â†’ `/sl/insights/[slug]/`

### ğŸ“ Note Implementazione

- **Node.js Scripts**: Usa script `.mjs` per batch operations (copia, rename, update frontmatter)
- **Imports MDX**: Path relativi da content root: `import Component from '../../components/Component.astro'`
- **Comments MDX**: Usa `{/* comment */}` non `<!-- comment -->`
- **Layout consistency**: `max-w-[1366px] mx-auto px-4 sm:px-6 lg:px-8` per tutte le pagine

### ğŸš¨ Errori Comuni da Evitare

1. **Non usare mai cartelle `/it/`, `/en/`, `/sl/` in content**
2. **Non dimenticare `baseUrl` in ArticleCard components**  
3. **Non mischiare slug con/senza prefisso linguistico**
4. **Non usare HTML comments in MDX** (causa errori di parsing)
5. **Non dimenticare di aggiornare `lang` nel frontmatter**

### ğŸ¯ Performance Notes

- Default language (IT) carica piÃ¹ velocemente (no prefisso)
- EN/SL hanno overhead minimo del prefisso nel filename
- Filtri `getCollection` sono efficienti con `startsWith()`
- Cache Astro funziona correttamente con questa struttura
